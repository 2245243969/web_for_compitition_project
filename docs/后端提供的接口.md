# 基金发行公告提取系统 - 完整API接口文档

## 📋 基础信息

- **生产环境**: `https://nybrzijdwpdn.sealoshzh.site/api`
- **开发环境**: `http://localhost:8000/api`
- **认证方式**: Bearer JWT Token
- **数据格式**: JSON
- **字符编码**: UTF-8
- **最大文件上传**: 50MB

### 环境说明

| 环境 | 基础URL | 说明 |
|------|---------|------|
| 生产环境 | `https://nybrzijdwpdn.sealoshzh.site/api` | 正式线上环境，支持HTTPS |
| 开发环境 | `http://localhost:8000/api` | 本地开发环境 |

### 统一响应格式

**成功响应:**
```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": {},
  "meta": {
    "timestamp": "2025-01-15T10:30:00.000Z",
    "requestId": "req_123456789",
    "version": "v1.2.0"
  }
}
```

**错误响应:**
```json
{
  "success": false,
  "code": 400,
  "message": "操作失败",
  "error": {
    "type": "ERROR_TYPE",
    "details": [
      {
        "field": "fieldName",
        "code": "ERROR_CODE",
        "message": "具体错误信息",
        "value": null
      }
    ]
  },
  "meta": {
    "timestamp": "2025-01-15T10:30:00.000Z",
    "requestId": "req_123456789",
    "version": "v1.2.0"
  }
}
```

---

## 🔐 认证接口 (`/api/auth/`)

### 1. 用户登录

**接口**: `POST /api/auth/login`
**权限**: 无需认证

**请求参数:**
```json
{
  "email": "user@example.com",
  "password": "password123",
  "rememberMe": false
}
```

**参数说明:**
| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| email | string | 是 | 用户邮箱 |
| password | string | 是 | 用户密码 |
| rememberMe | boolean | 否 | 是否记住登录状态，默认false |

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "登录成功",
  "data": {
    "user": {
      "id": "user_123456",
      "email": "user@example.com",
      "username": "testuser",
      "firstName": "张",
      "lastName": "三",
      "fullName": "张三",
      "avatar": "https://example.com/avatar.jpg",
      "role": "user",
      "permissions": ["document:read", "document:write"],
      "settings": {
        "language": "zh-CN",
        "timezone": "Asia/Shanghai",
        "emailNotifications": true,
        "theme": "light"
      },
      "stats": {
        "totalDocuments": 25,
        "totalExtractions": 50,
        "successRate": 96.0
      },
      "isActive": true,
      "isEmailVerified": true,
      "lastLoginAt": "2025-01-15T10:30:00.000Z",
      "createdAt": "2024-12-01T10:00:00.000Z"
    },
    "tokens": {
      "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "refreshToken": "refresh_token_string",
      "tokenType": "Bearer",
      "expiresIn": 3600,
      "expiresAt": "2025-01-15T11:30:00.000Z"
    },
    "session": {
      "sessionId": "session_123456",
      "ipAddress": "192.168.1.1",
      "userAgent": "Mozilla/5.0...",
      "location": {
        "country": "中国",
        "city": "北京"
      }
    }
  }
}
```

**错误响应:**
```json
// 401 - 账号密码错误
{
  "success": false,
  "code": 401,
  "message": "登录失败",
  "error": {
    "type": "AUTHENTICATION_FAILED",
    "details": [
      {
        "field": "credentials",
        "code": "INVALID_CREDENTIALS",
        "message": "邮箱或密码错误"
      }
    ]
  }
}

// 400 - 参数验证错误
{
  "success": false,
  "code": 400,
  "message": "参数验证失败",
  "error": {
    "type": "VALIDATION_ERROR",
    "details": [
      {
        "field": "email",
        "code": "VALIDATION_ERROR",
        "message": "这个字段是必填项。"
      }
    ]
  }
}
```

---

### 2. 用户注册

**接口**: `POST /api/auth/register`
**权限**: 无需认证

**请求参数:**
```json
{
  "email": "newuser@example.com",
  "password": "password123",
  "username": "newuser",
  "firstName": "李",
  "lastName": "四"
}
```

**参数说明:**
| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| email | string | 是 | 用户邮箱，必须唯一 |
| password | string | 是 | 密码，至少6位 |
| username | string | 是 | 用户名，必须唯一 |
| firstName | string | 否 | 名 |
| lastName | string | 否 | 姓 |

**成功响应 (201):**
```json
{
  "success": true,
  "code": 201,
  "message": "注册成功，请查收邮件验证账号",
  "data": {
    "user": {
      "id": "user_789012",
      "email": "newuser@example.com",
      "username": "newuser",
      "firstName": "李",
      "lastName": "四",
      "isActive": true,
      "isEmailVerified": false,
      "status": "PENDING_EMAIL_VERIFICATION"
    },
    "tokens": {
      "accessToken": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9...",
      "refreshToken": "refresh_token_string",
      "tokenType": "Bearer",
      "expiresIn": 3600,
      "expiresAt": "2025-01-15T11:30:00.000Z"
    },
    "verification": {
      "emailSent": true,
      "expiresAt": "2025-01-15T11:30:00.000Z"
    }
  }
}
```

---

### 3. Token刷新

**接口**: `POST /api/auth/refresh`
**权限**: 无需认证（需要有效的RefreshToken）

**请求参数:**
```json
{
  "refreshToken": "refresh_token_string"
}
```

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "Token刷新成功",
  "data": {
    "tokens": {
      "accessToken": "new_access_token",
      "refreshToken": "new_refresh_token",
      "tokenType": "Bearer",
      "expiresIn": 3600,
      "expiresAt": "2025-01-15T12:30:00.000Z"
    }
  }
}
```

---

### 4. 用户登出

**接口**: `POST /api/auth/logout`
**权限**: 需要认证
**请求头**: `Authorization: Bearer <access_token>`

**请求参数:**
```json
{
  "logoutAll": false
}
```

**参数说明:**
| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| logoutAll | boolean | 否 | 是否登出所有设备，默认false |

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "登出成功",
  "data": {
    "loggedOut": true,
    "sessionsTerminated": 1
  }
}
```

---

### 5. 邮箱验证

**接口**: `POST /api/auth/verify-email`
**权限**: 无需认证

**请求参数:**
```json
{
  "token": "email_verification_token",
  "email": "user@example.com"
}
```

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "邮箱验证成功",
  "data": {
    "verified": true
  }
}
```

---

### 6. 忘记密码

**接口**: `POST /api/auth/forgot-password`
**权限**: 无需认证

**请求参数:**
```json
{
  "email": "user@example.com"
}
```

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "密码重置邮件已发送",
  "data": {
    "emailSent": true,
    "expiresAt": "2025-01-15T11:30:00.000Z"
  }
}
```

---

### 7. 重置密码

**接口**: `POST /api/auth/reset-password`
**权限**: 无需认证

**请求参数:**
```json
{
  "token": "reset_token_from_email",
  "newPassword": "newpassword123",
  "confirmPassword": "newpassword123"
}
```

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "密码重置成功",
  "data": {
    "passwordReset": true
  }
}
```

---

## 📄 文档处理接口 (`/api/documents/`)

### 1. 文件上传

**接口**: `POST /api/documents/upload`
**权限**: 需要认证
**Content-Type**: `multipart/form-data`

**请求参数:**
```
file: File (PDF文件)
documentType: string (文档类型)
tags: string[] (可选标签)
description: string (可选描述)
folder: string (可选文件夹)
```

**文档类型:**
- `fund_contract` - 基金合同
- `custody_agreement` - 托管协议
- `prospectus` - 招募说明书
- `quarterly_report` - 季度报告
- `annual_report` - 年度报告
- `other` - 其他

**文件限制:**
- 支持格式: PDF
- 最大大小: 50MB
- 页数限制: 1000页

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "文件上传成功",
  "data": {
    "document": {
      "id": "doc_123456",
      "fileName": "fund_contract_20250115.pdf",
      "originalName": "某某基金合同.pdf",
      "documentType": "fund_contract",
      "fileSize": 5242880,
      "pageCount": 120,
      "mimeType": "application/pdf",
      "checksum": "md5:abcd1234...",
      "tags": ["基金合同", "混合型"],
      "description": "某某混合型基金合同文档",
      "folder": "contracts/2025",
      "status": "UPLOADED",
      "metadata": {
        "pdfVersion": "1.4",
        "title": "某某基金合同",
        "author": "某某基金管理公司",
        "encrypted": false,
        "hasText": true,
        "hasImages": true
      },
      "urls": {
        "download": "/api/documents/doc_123456/download-original",
        "preview": "/api/documents/doc_123456/preview"
      },
      "uploadedBy": {
        "id": "user_123456",
        "username": "testuser"
      },
      "uploadedAt": "2025-01-15T10:30:00.000Z"
    }
  }
}
```

**错误响应:**
```json
// 413 - 文件过大
{
  "success": false,
  "code": 413,
  "message": "文件大小超限",
  "error": {
    "type": "FILE_TOO_LARGE",
    "details": [
      {
        "field": "file",
        "message": "文件大小超过50MB限制"
      }
    ]
  }
}

// 415 - 文件格式不支持
{
  "success": false,
  "code": 415,
  "message": "文件格式不支持",
  "error": {
    "type": "UNSUPPORTED_MEDIA_TYPE",
    "details": [
      {
        "field": "file",
        "message": "只支持PDF格式文件"
      }
    ]
  }
}
```

---

### 2. 开始数据提取

**接口**: `POST /api/documents/{documentId}/extract`
**权限**: 需要认证

**请求参数:**
```json
{
  "extractionConfig": {
    "provider": "deepseek",
    "model": "deepseek-reasoner",
    "apiKey": "sk-your-api-key",
    "baseUrl": "https://api.deepseek.com/v1/chat/completions",
    "temperature": 0.1,
    "maxTokens": 8192,
    "timeout": 120,
    "maxRetries": 3
  },
  "extractionOptions": {
    "mode": "full",
    "fieldsToExtract": [
      "基金名称",
      "基金类型",
      "管理人名称",
      "托管人名称",
      "基金规模"
    ],
    "extractionDepth": "detailed",
    "includeConfidence": true,
    "includeSourceReferences": true,
    "validateResults": true,
    "outputFormat": "structured"
  },
  "processingOptions": {
    "priority": "normal",
    "async": true,
    "webhookUrl": "https://your-app.com/webhooks/extraction-complete",
    "notifyOnComplete": true,
    "retainIntermediateResults": false
  },
  "qualitySettings": {
    "minimumConfidence": 0.8,
    "crossValidation": true,
    "humanReview": false,
    "qualityCheckEnabled": true
  }
}
```

**参数说明:**
| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| extractionConfig.provider | string | 是 | AI提供商 (deepseek/openai) |
| extractionConfig.model | string | 是 | 模型名称 |
| extractionConfig.apiKey | string | 是 | API密钥 |
| extractionOptions.mode | string | 否 | 提取模式 (full/selective/smart) |
| extractionOptions.fieldsToExtract | array | 否 | 要提取的字段列表 |
| processingOptions.priority | string | 否 | 优先级 (low/normal/high/urgent) |

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "提取任务已启动",
  "data": {
    "task": {
      "id": "task_123456",
      "documentId": "doc_123456",
      "status": "PENDING",
      "priority": "normal",
      "estimatedDuration": 180,
      "progress": 0,
      "currentStep": "初始化提取任务",
      "steps": [
        {
          "name": "文档预处理",
          "status": "pending",
          "estimatedDuration": 30
        },
        {
          "name": "内容提取",
          "status": "pending",
          "estimatedDuration": 120
        },
        {
          "name": "结果验证",
          "status": "pending",
          "estimatedDuration": 30
        }
      ],
      "config": {
        "provider": "deepseek",
        "model": "deepseek-reasoner",
        "fieldsCount": 5,
        "extractionDepth": "detailed"
      },
      "createdAt": "2025-01-15T10:30:00.000Z",
      "estimatedCompletionAt": "2025-01-15T10:33:00.000Z"
    }
  }
}
```

---

### 3. 获取提取进度

**接口**: `GET /api/documents/tasks/{taskId}/progress`
**权限**: 需要认证

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "task": {
      "id": "task_123456",
      "documentId": "doc_123456",
      "status": "PROCESSING",
      "progress": 65,
      "currentStep": "正在提取基金基本信息",
      "currentStepProgress": 80,
      "estimatedTimeRemaining": 42,
      "steps": [
        {
          "name": "文档预处理",
          "status": "completed",
          "progress": 100,
          "startedAt": "2025-01-15T10:30:00.000Z",
          "completedAt": "2025-01-15T10:30:30.000Z",
          "duration": 30
        },
        {
          "name": "内容提取",
          "status": "processing",
          "progress": 65,
          "startedAt": "2025-01-15T10:30:30.000Z",
          "substeps": [
            {
              "name": "基金基本信息",
              "status": "processing",
              "progress": 80
            },
            {
              "name": "投资信息",
              "status": "pending",
              "progress": 0
            }
          ]
        },
        {
          "name": "结果验证",
          "status": "pending",
          "progress": 0
        }
      ],
      "statistics": {
        "fieldsProcessed": 15,
        "fieldsTotal": 23,
        "fieldsFound": 12,
        "fieldsNotFound": 3,
        "averageConfidence": 0.92,
        "processingSpeed": "2.3 fields/min"
      },
      "estimatedTimeRemaining": 42,
      "createdAt": "2025-01-15T10:30:00.000Z",
      "startedAt": "2025-01-15T10:30:05.000Z",
      "estimatedCompletionAt": "2025-01-15T10:32:30.000Z"
    }
  }
}
```

**任务状态:**
- `PENDING` - 等待中
- `PROCESSING` - 处理中
- `COMPLETED` - 已完成
- `FAILED` - 失败
- `CANCELLED` - 已取消

---

### 4. 获取提取结果

**接口**: `GET /api/documents/tasks/{taskId}/results`
**权限**: 需要认证

**查询参数:**
```
format=structured&includeMetadata=true&includeSourceRefs=true
```

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "result": {
      "id": "result_123456",
      "taskId": "task_123456",
      "documentId": "doc_123456",
      "status": "COMPLETED",
      "extractionSummary": {
        "totalFields": 50,
        "extractedFields": 47,
        "fieldsNotFound": 3,
        "averageConfidence": 0.94,
        "overallQuality": "excellent",
        "processingTime": 125,
        "modelUsed": "deepseek-reasoner",
        "extractionMode": "detailed"
      },
      "extractedData": {
        "BASIC_INFO": {
          "基金名称": {
            "value": "某某混合型证券投资基金",
            "confidence": 0.98,
            "source": {
              "page": 1,
              "coordinates": [100, 200, 400, 220],
              "text": "某某混合型证券投资基金基金合同"
            },
            "verified": true
          },
          "基金类型": {
            "value": "混合型",
            "confidence": 0.95,
            "source": {
              "page": 1,
              "coordinates": [100, 250, 200, 270],
              "text": "混合型证券投资基金"
            },
            "verified": true
          },
          "管理人名称": {
            "value": "某某基金管理有限公司",
            "confidence": 0.97,
            "source": {
              "page": 2,
              "coordinates": [100, 100, 350, 120],
              "text": "基金管理人：某某基金管理有限公司"
            },
            "verified": true
          }
        },
        "INVESTMENT_INFO": {
          "投资目标": {
            "value": "在严格控制投资风险的前提下，追求超越业绩比较基准的投资回报",
            "confidence": 0.93,
            "source": {
              "page": 5,
              "coordinates": [50, 100, 500, 150],
              "text": "本基金的投资目标是..."
            },
            "verified": true
          }
        }
      },
      "notFoundFields": [
        {
          "field": "基金托管费率",
          "reason": "文档中未明确提及",
          "suggestions": ["可能在费用说明章节", "可能以表格形式呈现"]
        }
      ],
      "qualityMetrics": {
        "dataCompleteness": 0.94,
        "informationAccuracy": 0.96,
        "sourceReliability": 0.95,
        "crossValidationScore": 0.93,
        "overallScore": 0.94
      },
      "warnings": [
        {
          "type": "LOW_CONFIDENCE",
          "field": "基金规模",
          "message": "该字段置信度较低，建议人工复核",
          "confidence": 0.72
        }
      ],
      "recommendations": [
        {
          "type": "MANUAL_REVIEW",
          "message": "建议人工复核低置信度字段",
          "affectedFields": ["基金规模"]
        }
      ],
      "processingDetails": {
        "modelUsed": "deepseek-reasoner",
        "tokenConsumed": 15420,
        "apiCallsCount": 8,
        "preprocessingTime": 15,
        "extractionTime": 95,
        "validationTime": 15,
        "totalProcessingTime": 125
      },
      "createdAt": "2025-01-15T10:32:05.000Z",
      "completedAt": "2025-01-15T10:34:10.000Z"
    }
  }
}
```

---

### 5. 获取字段配置

**接口**: `GET /api/documents/field-config/{documentType}`
**权限**: 需要认证

**路径参数:**
- `documentType`: 文档类型 (fund_contract | custody_agreement | prospectus)

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "documentType": "fund_contract",
    "label": "基金合同",
    "description": "基金合同文档字段配置",
    "version": "v2.1",
    "totalFields": 85,
    "lastUpdated": "2025-01-10T00:00:00.000Z",
    "modules": [
      {
        "module": "BASIC_INFO",
        "label": "基金基本信息",
        "description": "基金的基础信息，包括名称、类型等",
        "order": 1,
        "required": true,
        "fieldCount": 15,
        "fields": [
          {
            "key": "基金名称",
            "label": "基金名称",
            "description": "基金的完整法定名称",
            "type": "text",
            "dataType": "string",
            "required": true,
            "maxLength": 100,
            "validation": {
              "pattern": ".*基金$",
              "message": "基金名称应以'基金'结尾"
            },
            "examples": [
              "某某混合型证券投资基金",
              "ABC债券型证券投资基金"
            ],
            "searchKeywords": [
              "基金名称",
              "基金简称",
              "本基金"
            ],
            "extractionHints": [
              "通常在文档首页或标题中",
              "可能包含'证券投资基金'字样"
            ],
            "confidence": {
              "high": 0.9,
              "medium": 0.7,
              "low": 0.5
            }
          }
        ]
      }
    ]
  }
}
```

---

### 6. 获取处理历史

**接口**: `GET /api/documents/history`
**权限**: 需要认证

**查询参数:**
```
page=1&pageSize=20&documentType=fund_contract&status=completed&startDate=2025-01-01&endDate=2025-01-15&sortBy=createdAt&sortOrder=desc&search=基金合同
```

**参数说明:**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| page | number | 否 | 页码，默认1 |
| pageSize | number | 否 | 每页数量，默认20 |
| documentType | string | 否 | 文档类型过滤 |
| status | string | 否 | 状态过滤 |
| startDate | string | 否 | 开始日期 (YYYY-MM-DD) |
| endDate | string | 否 | 结束日期 (YYYY-MM-DD) |
| sortBy | string | 否 | 排序字段 |
| sortOrder | string | 否 | 排序方向 (asc/desc) |
| search | string | 否 | 搜索关键词 |

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "items": [
      {
        "id": "doc_123456",
        "fileName": "某某基金合同.pdf",
        "originalName": "基金合同-最终版.pdf",
        "documentType": "fund_contract",
        "documentTypeLabel": "基金合同",
        "fileSize": 5242880,
        "fileSizeFormatted": "5.0 MB",
        "pageCount": 120,
        "status": "COMPLETED",
        "statusLabel": "处理完成",
        "extractionTasks": [
          {
            "id": "task_123456",
            "status": "COMPLETED",
            "fieldsExtracted": 47,
            "totalFields": 50,
            "extractionRate": 0.94,
            "averageConfidence": 0.92,
            "processingTime": 125,
            "completedAt": "2025-01-15T10:34:10.000Z"
          }
        ],
        "tags": ["基金合同", "混合型", "2025年"],
        "folder": "contracts/2025",
        "uploadedBy": {
          "id": "user_123456",
          "username": "testuser",
          "fullName": "张三"
        },
        "createdAt": "2025-01-15T10:30:00.000Z",
        "updatedAt": "2025-01-15T10:34:10.000Z",
        "lastAccessedAt": "2025-01-15T15:20:00.000Z",
        "accessCount": 5,
        "downloadCount": 2,
        "shareStatus": "private"
      }
    ],
    "pagination": {
      "page": 1,
      "pageSize": 20,
      "total": 156,
      "totalPages": 8,
      "hasNext": true,
      "hasPrev": false,
      "nextPage": 2,
      "prevPage": null
    },
    "statistics": {
      "totalDocuments": 156,
      "completedDocuments": 145,
      "processingDocuments": 8,
      "failedDocuments": 3,
      "averageProcessingTime": 98,
      "successRate": 0.929
    }
  }
}
```

---

### 7. 导出提取结果

**接口**: `POST /api/documents/export`
**权限**: 需要认证

**请求参数:**
```json
{
  "exportType": "extraction_results",
  "format": "excel",
  "scope": {
    "type": "tasks",
    "taskIds": ["task_123456", "task_123457"],
    "includeMetadata": true,
    "includeSourceReferences": true
  },
  "filters": {
    "fieldsFilter": ["基金名称", "基金类型", "管理人名称"],
    "minimumConfidence": 0.8,
    "documentTypes": ["fund_contract"],
    "dateRange": {
      "startDate": "2025-01-01",
      "endDate": "2025-01-15"
    }
  },
  "options": {
    "groupBy": "documentType",
    "includeCharts": true,
    "includeStatistics": true,
    "template": "standard",
    "language": "zh-CN",
    "watermark": "机密文档 - 仅供内部使用"
  },
  "delivery": {
    "method": "download",
    "email": "user@example.com",
    "webhookUrl": "https://your-app.com/webhooks/export-ready"
  }
}
```

**参数说明:**
| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| exportType | string | 是 | 导出类型 |
| format | string | 是 | 导出格式 (excel/csv/json/pdf) |
| scope.type | string | 是 | 范围类型 (tasks/documents/date_range) |
| scope.taskIds | array | 否 | 任务ID列表 |
| delivery.method | string | 是 | 交付方式 (download/email/webhook) |

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "导出任务已创建",
  "data": {
    "export": {
      "id": "export_123456",
      "status": "PROCESSING",
      "format": "excel",
      "estimatedSize": "2.5 MB",
      "estimatedTime": 30,
      "progress": 0,
      "downloadUrl": null,
      "fileName": "extraction_results_20250115_103000.xlsx",
      "includesData": {
        "documentsCount": 25,
        "tasksCount": 25,
        "fieldsCount": 250,
        "dateRange": {
          "start": "2025-01-01",
          "end": "2025-01-15"
        }
      },
      "expiresAt": "2025-01-16T10:30:00.000Z",
      "createdAt": "2025-01-15T10:30:00.000Z"
    }
  }
}
```

---

### 8. 原文档下载链接获取

**接口**: `GET /api/documents/{documentId}/download-original`
**权限**: 需要认证

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "downloadUrl": "/api/documents/doc_123456/download-original/serve",
    "fileName": "某某基金合同.pdf",
    "fileSize": 5242880,
    "expiresAt": "2025-01-15T11:30:00.000Z",
    "accessCode": "download_123456"
  }
}
```

---

### 9. 原文档下载

**接口**: `GET /api/documents/{documentId}/download-original/serve`
**权限**: 需要认证
**响应**: 直接返回文件流

---

## 👤 用户管理接口 (`/api/users/`)

### 1. 获取用户信息

**接口**: `GET /api/users/profile`
**权限**: 需要认证

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "user": {
      "id": "user_123456",
      "email": "user@example.com",
      "username": "testuser",
      "firstName": "张",
      "lastName": "三",
      "fullName": "张三",
      "avatar": "https://example.com/avatar/123456.jpg",
      "phone": "+86 138 0013 8000",
      "company": "某某公司",
      "role": "user",
      "permissions": ["document:read", "document:write"],
      "settings": {
        "language": "zh-CN",
        "timezone": "Asia/Shanghai",
        "dateFormat": "YYYY-MM-DD",
        "timeFormat": "24h",
        "emailNotifications": true,
        "smsNotifications": false,
        "theme": "light"
      },
      "stats": {
        "totalDocuments": 25,
        "totalExtractions": 50,
        "successfulExtractions": 48,
        "successRate": 96.0,
        "totalProcessingTime": 3600,
        "averageProcessingTime": 72,
        "favoriteDocumentType": "fund_contract"
      },
      "subscription": {
        "plan": "premium",
        "status": "active",
        "expiresAt": "2025-12-31T23:59:59.000Z",
        "features": ["unlimited_extractions", "priority_processing", "api_access"]
      },
      "isActive": true,
      "isEmailVerified": true,
      "isPhoneVerified": false,
      "lastLoginAt": "2025-01-15T09:30:00.000Z",
      "createdAt": "2024-12-01T10:00:00.000Z",
      "updatedAt": "2025-01-14T16:20:00.000Z"
    }
  }
}
```

---

### 2. 更新用户信息

**接口**: `PUT /api/users/profile`
**权限**: 需要认证

**请求参数:**
```json
{
  "firstName": "新姓",
  "lastName": "新名",
  "phone": "+86 139 0013 9000",
  "company": "新公司名称",
  "settings": {
    "language": "en-US",
    "timezone": "America/New_York",
    "emailNotifications": false,
    "theme": "dark"
  },
  "bio": "个人简介信息"
}
```

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "更新成功",
  "data": {
    "user": {
      // 更新后的完整用户信息
    },
    "changes": [
      {
        "field": "firstName",
        "oldValue": "张",
        "newValue": "新姓"
      },
      {
        "field": "settings.language",
        "oldValue": "zh-CN",
        "newValue": "en-US"
      }
    ]
  }
}
```

---

### 3. 上传头像

**接口**: `POST /api/users/avatar`
**权限**: 需要认证
**Content-Type**: `multipart/form-data`

**请求参数:**
```
avatar: File (图片文件)
```

**文件限制:**
- 支持格式: jpg, jpeg, png, gif, webp
- 最大大小: 5MB
- 建议尺寸: 300x300px

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "头像上传成功",
  "data": {
    "avatar": {
      "original": "https://example.com/avatar/original/123456.jpg",
      "thumbnail": "https://example.com/avatar/thumb/123456.jpg",
      "small": "https://example.com/avatar/small/123456.jpg",
      "medium": "https://example.com/avatar/medium/123456.jpg"
    },
    "upload": {
      "fileId": "file_123456",
      "fileName": "avatar_123456.jpg",
      "fileSize": 1024000,
      "mimeType": "image/jpeg",
      "uploadedAt": "2025-01-15T10:30:00.000Z"
    }
  }
}
```

---

### 4. 修改密码

**接口**: `PUT /api/users/password`
**权限**: 需要认证

**请求参数:**
```json
{
  "currentPassword": "currentpassword123",
  "newPassword": "newpassword123",
  "confirmPassword": "newpassword123"
}
```

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "密码修改成功",
  "data": {
    "passwordChanged": true,
    "tokensInvalidated": true,
    "requireReauth": true
  }
}
```

---

### 5. 获取活动日志

**接口**: `GET /api/users/activity-logs`
**权限**: 需要认证

**查询参数:**
```
page=1&pageSize=20&action=login&startDate=2025-01-01&endDate=2025-01-15
```

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "items": [
      {
        "id": "log_123456",
        "action": "USER_LOGIN",
        "details": "用户从IP 192.168.1.1 登录",
        "ipAddress": "192.168.1.1",
        "userAgent": "Mozilla/5.0...",
        "location": {
          "country": "中国",
          "city": "北京"
        },
        "timestamp": "2025-01-15T10:30:00.000Z",
        "success": true
      }
    ],
    "pagination": {
      "page": 1,
      "pageSize": 20,
      "total": 100,
      "totalPages": 5,
      "hasNext": true,
      "hasPrev": false
    }
  }
}
```

---

## ⚙️ 系统配置接口 (`/api/system/`)

### 1. 保存API配置

**接口**: `POST /api/system/users/api-settings`
**权限**: 需要认证

**请求参数:**
```json
{
  "configs": [
    {
      "provider": "deepseek",
      "apiKey": "sk-your-deepseek-key",
      "baseUrl": "https://api.deepseek.com/v1/chat/completions",
      "modelName": "deepseek-reasoner",
      "maxTokens": 8192,
      "temperature": 0.1,
      "timeout": 120,
      "maxRetries": 3,
      "isDefault": true,
      "isActive": true
    },
    {
      "provider": "openai",
      "apiKey": "sk-your-openai-key",
      "baseUrl": "https://api.openai.com/v1/chat/completions",
      "modelName": "gpt-4",
      "maxTokens": 4096,
      "temperature": 0.1,
      "timeout": 60,
      "maxRetries": 3,
      "isDefault": false,
      "isActive": true
    }
  ],
  "preferences": {
    "autoSelectBestModel": true,
    "fallbackEnabled": true,
    "costOptimization": true
  }
}
```

**参数说明:**
| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| configs | array | 是 | API配置列表 |
| configs[].provider | string | 是 | 提供商名称 (deepseek/openai) |
| configs[].apiKey | string | 是 | API密钥 |
| configs[].baseUrl | string | 是 | API基础URL |
| configs[].modelName | string | 是 | 模型名称 |
| configs[].isDefault | boolean | 否 | 是否为默认配置 |
| configs[].isActive | boolean | 否 | 是否激活 |

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "API配置保存成功",
  "data": {
    "configId": "config_user_123456",
    "savedAt": "2025-01-15T10:30:00.000Z",
    "configsCount": 2
  }
}
```

---

### 2. 获取API配置

**接口**: `GET /api/system/users/api-settings`
**权限**: 需要认证

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "configs": [
      {
        "provider": "deepseek",
        "apiKey": "sk-xxx***xxx",
        "baseUrl": "https://api.deepseek.com/v1/chat/completions",
        "modelName": "deepseek-reasoner",
        "timeout": 120,
        "maxRetries": 3,
        "temperature": 0.1,
        "maxTokens": 8192,
        "isDefault": true,
        "isActive": true,
        "isValid": true,
        "lastTested": "2025-01-15T10:00:00.000Z",
        "lastUpdated": "2025-01-15T09:30:00.000Z"
      }
    ],
    "preferences": {
      "autoSelectBestModel": true,
      "fallbackEnabled": true,
      "costOptimization": true
    }
  }
}
```

---

### 3. 测试API连接

**接口**: `POST /api/system/users/api-settings/test`
**权限**: 需要认证

**请求参数:**
```json
{
  "provider": "deepseek",
  "apiKey": "sk-your-api-key",
  "baseUrl": "https://api.deepseek.com/v1/chat/completions",
  "modelName": "deepseek-reasoner"
}
```

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "API连接测试成功",
  "data": {
    "testResult": {
      "success": true,
      "responseTime": 850,
      "latency": "850ms",
      "modelInfo": {
        "name": "deepseek-reasoner",
        "provider": "DeepSeek",
        "version": "2024-11-27",
        "contextWindow": 32768,
        "inputCost": "$0.055/1M tokens",
        "outputCost": "$0.28/1M tokens"
      },
      "capabilities": [
        "text-generation",
        "reasoning",
        "code-understanding",
        "multi-language"
      ],
      "testMessage": "API连接正常，模型响应良好",
      "performance": {
        "speed": "fast",
        "reliability": "high",
        "qualityScore": 0.92
      },
      "quota": {
        "remaining": "95%",
        "resetAt": "2025-01-16T00:00:00.000Z"
      }
    }
  }
}
```

**错误响应:**
```json
// 408 - 连接超时
{
  "success": false,
  "code": 408,
  "message": "API请求超时",
  "error": {
    "type": "API_TIMEOUT",
    "details": [
      {
        "field": "api",
        "message": "API请求超时，请检查网络连接或调整超时设置"
      }
    ]
  }
}

// 503 - 连接失败
{
  "success": false,
  "code": 503,
  "message": "API连接失败",
  "error": {
    "type": "CONNECTION_ERROR",
    "details": [
      {
        "field": "api",
        "message": "API连接失败，请检查网络连接和API地址"
      }
    ]
  }
}
```

---

### 4. 获取系统统计

**接口**: `GET /api/system/statistics`
**权限**: 需要认证

**查询参数:**
```
period=7d&includeDetails=true&groupBy=day
```

**参数说明:**
| 参数 | 类型 | 必填 | 说明 |
|------|------|------|------|
| period | string | 否 | 时间周期 (1d/7d/30d) |
| includeDetails | boolean | 否 | 是否包含详细信息 |
| groupBy | string | 否 | 分组方式 (day/week/month) |

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "获取成功",
  "data": {
    "overview": {
      "totalDocuments": 1250,
      "totalExtractions": 1890,
      "totalUsers": 125,
      "activeUsers": 89,
      "successRate": 94.8,
      "averageProcessingTime": 87.5,
      "systemHealth": 96.2,
      "uptime": "99.9%"
    },
    "periodStats": {
      "period": "7d",
      "startDate": "2025-01-08T00:00:00.000Z",
      "endDate": "2025-01-15T23:59:59.000Z",
      "documentsUploaded": 85,
      "extractionsCompleted": 102,
      "newUsers": 8,
      "activeUsers": 45,
      "totalProcessingTime": 8925,
      "averageProcessingTime": 87.5,
      "successRate": 96.1
    },
    "documentTypes": [
      {
        "type": "fund_contract",
        "label": "基金合同",
        "count": 520,
        "percentage": 41.6,
        "successRate": 96.3,
        "averageProcessingTime": 95.2
      },
      {
        "type": "custody_agreement",
        "label": "托管协议",
        "count": 380,
        "percentage": 30.4,
        "successRate": 94.2,
        "averageProcessingTime": 78.5
      },
      {
        "type": "prospectus",
        "label": "招募说明书",
        "count": 350,
        "percentage": 28.0,
        "successRate": 93.8,
        "averageProcessingTime": 105.3
      }
    ],
    "performance": {
      "systemLoad": {
        "cpu": 45.2,
        "memory": 67.8,
        "disk": 23.4,
        "network": 12.1
      },
      "processingQueue": {
        "pending": 3,
        "processing": 5,
        "completed": 197,
        "failed": 2,
        "averageWaitTime": 15.2
      },
      "apiPerformance": {
        "deepseek": {
          "successRate": 97.2,
          "averageResponseTime": 850,
          "errorRate": 2.8,
          "quota": "89% remaining"
        },
        "openai": {
          "successRate": 95.8,
          "averageResponseTime": 1200,
          "errorRate": 4.2,
          "quota": "76% remaining"
        }
      }
    },
    "trends": {
      "daily": [
        {
          "date": "2025-01-15",
          "documents": 12,
          "extractions": 15,
          "users": 8,
          "successRate": 93.3
        },
        {
          "date": "2025-01-14",
          "documents": 18,
          "extractions": 22,
          "users": 12,
          "successRate": 95.5
        }
      ]
    },
    "topUsers": [
      {
        "userId": "user_123456",
        "username": "张三",
        "documentsCount": 45,
        "extractionsCount": 67,
        "successRate": 97.8
      }
    ],
    "errors": {
      "last24h": 5,
      "commonErrors": [
        {
          "type": "API_TIMEOUT",
          "count": 3,
          "percentage": 60.0
        },
        {
          "type": "INVALID_PDF",
          "count": 2,
          "percentage": 40.0
        }
      ]
    }
  }
}
```

---

### 5. 系统健康检查

**接口**: `GET /api/system/health`
**权限**: 无需认证（公开接口）

**成功响应 (200):**
```json
{
  "success": true,
  "code": 200,
  "message": "系统健康",
  "data": {
    "status": "healthy",
    "timestamp": "2025-01-15T10:30:00.000Z",
    "uptime": 86400,
    "version": "v1.2.0",
    "environment": "production",
    "services": {
      "database": {
        "status": "healthy",
        "responseTime": 25,
        "connections": {
          "active": 12,
          "max": 100,
          "idle": 88
        }
      },
      "redis": {
        "status": "healthy",
        "responseTime": 5,
        "memory": {
          "used": "245 MB",
          "max": "2 GB",
          "percentage": 12.25
        }
      },
      "storage": {
        "status": "healthy",
        "available": "850 GB",
        "used": "150 GB",
        "percentage": 15.0
      },
      "aiProviders": {
        "deepseek": {
          "status": "healthy",
          "responseTime": 850,
          "quota": "89%"
        },
        "openai": {
          "status": "healthy",
          "responseTime": 1200,
          "quota": "76%"
        }
      }
    },
    "metrics": {
      "requestsPerSecond": 25.4,
      "averageResponseTime": 145,
      "errorRate": 0.02,
      "memoryUsage": 67.8,
      "cpuUsage": 45.2
    }
  }
}
```

**系统状态:**
- `healthy` - 健康
- `degraded` - 降级（部分功能受影响）
- `unhealthy` - 不健康

---

## 🚨 错误处理

### HTTP状态码说明

| 状态码 | 含义 | 使用场景 |
|--------|------|----------|
| 200 | OK | 请求成功 |
| 201 | Created | 资源创建成功 |
| 400 | Bad Request | 请求参数错误 |
| 401 | Unauthorized | 未授权，需要登录 |
| 403 | Forbidden | 已登录但权限不足 |
| 404 | Not Found | 资源不存在 |
| 408 | Request Timeout | 请求超时 |
| 413 | Payload Too Large | 请求体过大 |
| 415 | Unsupported Media Type | 不支持的媒体类型 |
| 422 | Unprocessable Entity | 数据验证失败 |
| 423 | Locked | 账号被锁定 |
| 429 | Too Many Requests | 请求频率超限 |
| 500 | Internal Server Error | 服务器内部错误 |
| 502 | Bad Gateway | 网关错误 |
| 503 | Service Unavailable | 服务不可用 |

### 业务错误码

#### 认证相关错误
| 错误码 | 描述 | 处理方式 |
|--------|------|----------|
| AUTH_001 | 邮箱或密码错误 | 重新输入正确的凭据 |
| AUTH_002 | 账号已被锁定 | 等待解锁时间或联系管理员 |
| AUTH_003 | Token已过期 | 使用RefreshToken获取新Token |
| AUTH_004 | Token无效 | 重新登录 |
| AUTH_005 | 邮箱未验证 | 验证邮箱后再试 |

#### 文档处理相关错误
| 错误码 | 描述 | 处理方式 |
|--------|------|----------|
| DOC_001 | 文件格式不支持 | 上传PDF格式文件 |
| DOC_002 | 文件大小超限 | 压缩文件或分割上传 |
| DOC_003 | 文件损坏或加密 | 修复文件或解除加密 |
| DOC_004 | 文档页数超限 | 分割文档或联系管理员 |
| DOC_005 | 提取任务失败 | 检查文档质量或重试 |

#### AI服务相关错误
| 错误码 | 描述 | 处理方式 |
|--------|------|----------|
| AI_001 | API密钥无效 | 检查并更新API密钥 |
| AI_002 | API配额不足 | 等待配额重置或升级计划 |
| AI_003 | 模型服务不可用 | 切换到其他模型或稍后重试 |
| AI_004 | 请求超时 | 增加超时时间或重试 |
| AI_005 | 内容被拒绝 | 检查文档内容是否符合政策 |

---

## 🔧 开发调试

### 请求示例

**使用curl (生产环境):**
```bash
# 登录
curl -X POST https://nybrzijdwpdn.sealoshzh.site/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "password123"
  }'

# 上传文件（需要先登录获取token）
curl -X POST https://nybrzijdwpdn.sealoshzh.site/api/documents/upload \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@document.pdf" \
  -F "documentType=fund_contract" \
  -F "description=测试文档"

# 获取用户信息
curl -X GET https://nybrzijdwpdn.sealoshzh.site/api/users/profile \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**使用curl (本地开发):**
```bash
# 登录
curl -X POST http://localhost:8000/api/auth/login \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "password123"
  }'

# 上传文件（需要先登录获取token）
curl -X POST http://localhost:8000/api/documents/upload \
  -H "Authorization: Bearer YOUR_TOKEN" \
  -F "file=@document.pdf" \
  -F "documentType=fund_contract" \
  -F "description=测试文档"

# 获取用户信息
curl -X GET http://localhost:8000/api/users/profile \
  -H "Authorization: Bearer YOUR_TOKEN"
```

**使用JavaScript (Fetch):**

```javascript
// 配置API基础URL
const API_BASE_URL = 'https://nybrzijdwpdn.sealoshzh.site/api'; // 生产环境
// const API_BASE_URL = 'http://localhost:8000/api'; // 本地开发环境

// 登录
const loginResponse = await fetch(`${API_BASE_URL}/auth/login`, {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json',
  },
  body: JSON.stringify({
    email: 'user@example.com',
    password: 'password123'
  })
});

const loginData = await loginResponse.json();
const token = loginData.data.tokens.accessToken;

// 获取用户信息
const profileResponse = await fetch(`${API_BASE_URL}/users/profile`, {
  headers: {
    'Authorization': `Bearer ${token}`
  }
});

const profileData = await profileResponse.json();
console.log(profileData.data.user);

// 文件上传
const formData = new FormData();
formData.append('file', fileInput.files[0]);
formData.append('documentType', 'fund_contract');
formData.append('description', '测试文档');

const uploadResponse = await fetch(`${API_BASE_URL}/documents/upload`, {
  method: 'POST',
  headers: {
    'Authorization': `Bearer ${token}`
  },
  body: formData
});

const uploadData = await uploadResponse.json();
console.log(uploadData.data.document);
```

### 常见问题解决

1. **CORS错误**: 确保前端域名在后端CORS配置中
2. **Token过期**: 使用refresh token刷新或重新登录
3. **文件上传失败**: 检查文件大小和格式
4. **API连接失败**: 检查API密钥和网络连接

---

## 📝 更新日志

### v1.2.0 (2025-01-15)
- 新增文档批量处理功能
- 优化AI模型配置管理
- 增强系统监控和统计
- 改进错误处理和响应格式
- 新增文档导出功能

### v1.1.0 (2024-12-01)
- 基础认证和用户管理
- 文档上传和提取功能
- 基本的系统配置

---

## 📞 技术支持

- **项目地址**: GitHub Repository
- **问题反馈**: Issues
- **邮箱**: dev@fund-extract.com
- **文档**: 本API文档

---

**注意**: 
1. 所有需要认证的接口都需要在请求头中携带有效的JWT Token
2. 文件上传接口需要使用 `multipart/form-data` 格式
3. 所有日期时间格式均为ISO 8601标准 (YYYY-MM-DDTHH:mm:ss.sssZ)
4. API有频率限制，请合理控制调用频率
5. 生产环境 `https://nybrzijdwpdn.sealoshzh.site/api` 使用HTTPS协议，确保数据传输安全
6. 开发环境可以使用 `http://localhost:8000/api` 进行本地调试
