import{_ as e,S as t,c as a,w as s,D as n,f as i,e as o,M as r,i as c,j as l,o as d,k as u,E as m,l as h,m as f,p as g,F as p,q as v,G as _,u as y,t as D,H as S,P}from"./index-CMSmlURr.js";const b=e({components:{Sidebar:t},data:()=>({selectedPeriod:"7d",isLoading:!0,apiStatistics:null,timePeriods:[{label:"ä»Šæ—¥",value:"1d"},{label:"7å¤©",value:"7d"},{label:"30å¤©",value:"30d"},{label:"90å¤©",value:"90d"},{label:"å…¨éƒ¨",value:"all"}],documentData:[],hoveredSegment:null,hoverPosition:{x:0,y:0},typeColors:{"å‘å”®å…¬å‘Š":"#4F46E5","æ‹›å‹Ÿè¯´æ˜ä¹¦":"#059669","åŸºé‡‘åˆåŒ":"#DC2626","å…¶ä»–":"#6B7280"},animationProgress:0,isAnimating:!1,animationFrameId:null}),computed:{filteredData(){const e=new Date;let t=this.documentData;switch(this.selectedPeriod){case"1day":const a=new Date(e.getTime()-864e5);t=t.filter(e=>new Date(e.time)>=a);break;case"3days":const s=new Date(e.getTime()-2592e5);t=t.filter(e=>new Date(e.time)>=s);break;case"1week":const n=new Date(e.getTime()-6048e5);t=t.filter(e=>new Date(e.time)>=n);break;case"1month":const i=new Date(e.getTime()-2592e6);t=t.filter(e=>new Date(e.time)>=i)}return t},documentTypeStats(){const e={fund_contract:0,custody_agreement:0,prospectus:0};return this.filteredData.forEach(t=>{if("success"===t.status){const a=t.documentType;e.hasOwnProperty(a)&&(e[a]=(e[a]||0)+1)}}),e},totalDocuments(){return this.apiStatistics&&this.apiStatistics.totalDocuments||this.filteredData.length},successCount(){return this.apiStatistics&&this.apiStatistics.totalDocuments||this.filteredData.filter(e=>"success"===e.status).length},chartSegments(){const e=this.documentTypeStats,t=this.successCount;if(0===t)return[];let a=0;const s=[],n=360*this.animationProgress,i=Object.entries(e),o=i.map(([e,a])=>a/t*360);return i.forEach(([e,i],r)=>{const c=o[r],l=a+.5*c,d=Math.min(a+c,Math.max(a,n));if(a<n&&d>a){const n={id:e,name:this.getDocumentTypeLabel(e),count:i,percentage:Math.round(i/t*100),color:this.getTypeColor(e),startAngle:a,endAngle:d,midAngle:l,path:this.createArcPath(a,d,!1),hoverPath:this.createArcPath(a,d,!0),hoverTransform:this.createHoverTransform(l),isHovered:this.hoveredSegment&&this.hoveredSegment.name===this.getDocumentTypeLabel(e),opacity:Math.min(1,1.2*this.animationProgress)};s.push(n)}a+=c}),s}},methods:{async loadStatistics(){this.isLoading=!0;try{const t=await i();if(t){this.apiStatistics=t;const a={page:1,pageSize:50,sortBy:"createdAt",sortOrder:"desc"};if("all"!==this.selectedPeriod){const e=(new Date).toISOString().split("T")[0];let t=new Date;switch(this.selectedPeriod){case"1d":t.setDate(t.getDate()-1);break;case"7d":t.setDate(t.getDate()-7);break;case"30d":t.setDate(t.getDate()-30);break;case"90d":t.setDate(t.getDate()-90)}a.startDate=t.toISOString().split("T")[0],a.endDate=e}try{console.log("ğŸ“Š è·å–å†å²æ•°æ®ï¼ŒæŸ¥è¯¢å‚æ•°:",a);const e=await o(a);if(e&&(e.documents||e.records)){const t=e.documents||e.records||[];this.documentData=t.map(e=>({fileName:e.fileName||e.originalName,time:new Date(e.createdAt||e.uploadTime).toLocaleString("zh-CN"),status:"COMPLETED"===e.status||"completed"===e.status?"success":"PROCESSING"===e.status||"processing"===e.status?"processing":"failed",documentType:e.documentType}))}else this.documentData=[]}catch(e){console.warn("è·å–æ–‡æ¡£å†å²å¤±è´¥ï¼Œä½¿ç”¨æ¼”ç¤ºæ•°æ®:",e)}}}catch(t){console.error("åŠ è½½ç»Ÿè®¡æ•°æ®å¤±è´¥:",t),r(t,{context:"statistics_load"})}finally{this.isLoading=!1,setTimeout(()=>{this.startChartAnimation()},100)}},selectTimePeriod(e){this.selectedPeriod!==e&&(this.selectedPeriod=e,this.loadStatistics())},startChartAnimation(){this.animationFrameId&&cancelAnimationFrame(this.animationFrameId),this.isAnimating=!0,this.animationProgress=0;const e=performance.now();let t=0;const a=s=>{if(s-t<16.67)return void(this.animationFrameId=requestAnimationFrame(a));t=s;let n=(s-e)/1500;n>=1?(this.animationProgress=1,this.isAnimating=!1,this.animationFrameId=null):(this.animationProgress=this.easeOutQuart(n),this.animationFrameId=requestAnimationFrame(a))};this.animationFrameId=requestAnimationFrame(a)},easeOutQuart:e=>1-Math.pow(1-e,4),getTimeRangeText(){const e=this.timePeriods.find(e=>e.value===this.selectedPeriod);return e?e.label:"å…¨éƒ¨æ—¶é—´"},getDocumentTypeName:e=>({"å‘å”®å…¬å‘Š":"å‘å”®å…¬å‘Š","æ‹›å‹Ÿè¯´æ˜ä¹¦":"æ‹›å‹Ÿè¯´æ˜ä¹¦","åŸºé‡‘åˆåŒ":"åŸºé‡‘åˆåŒ","å…¶ä»–":"å…¶ä»–"}[e]||e),getTypePercentage(e){return 0===this.successCount?0:Math.round(e/this.successCount*100)},createArcPath(e,t,a=!1){if(t-e<.1)return"";const s=a?12:0,n=80+s,i=40+s,o=.017453292519943295*(e-90),r=.017453292519943295*(t-90),c=Math.cos(o),l=Math.sin(o),d=Math.cos(r),u=Math.sin(r),m=l*n,h=d*n,f=u*n,g=d*i,p=u*i,v=c*i,_=l*i,y=t-e>180?1:0;return`M${(c*n).toFixed(2)},${m.toFixed(2)}A${n},${n},0,${y},1,${h.toFixed(2)},${f.toFixed(2)}L${g.toFixed(2)},${p.toFixed(2)}A${i},${i},0,${y},0,${v.toFixed(2)},${_.toFixed(2)}Z`},createHoverTransform(e){const t=(e-90)*Math.PI/180;return`translate(${5*Math.cos(t)}, ${5*Math.sin(t)})`},onSegmentHover(e,t){this.hoveredSegment={name:e.name,count:e.count,percentage:e.percentage},this.updateHoverPosition(t)},onLegendHover(e){this.hoveredSegment={name:e.name,count:e.count,percentage:e.percentage}},onSegmentMove(e){this.updateHoverPosition(e)},updateHoverPosition(e){this.hoverPosition={x:e.clientX,y:e.clientY}},clearHover(){this.hoveredSegment=null},getDocumentTypeLabel:e=>({fund_contract:"åŸºé‡‘åˆåŒ",custody_agreement:"æ‰˜ç®¡åè®®",prospectus:"æ‹›å‹Ÿè¯´æ˜ä¹¦"}[e]||e),getDocumentTypeIcon:e=>({fund_contract:"ğŸ“„",custody_agreement:"ğŸ¦",prospectus:"ğŸ“Š"}[e]||"ğŸ“„"),getTypeColor:e=>({fund_contract:"#667eea",custody_agreement:"#f093fb",prospectus:"#4facfe"}[e]||"#999999")},onLoad(){n()&&this.loadStatistics()},mounted(){this.$nextTick(()=>{this.startChartAnimation()})},beforeUnmount(){this.isAnimating=!1,this.animationFrameId&&cancelAnimationFrame(this.animationFrameId)}},[["render",function(e,t,n,i,o,r){const b=l("Sidebar"),w=h,T=c,M=_;return d(),a(T,{class:"web-layout"},{default:s(()=>[u(b),u(T,{class:"web-content"},{default:s(()=>[u(T,{class:"content-wrapper"},{default:s(()=>[u(T,{class:"page-header fade-in-up"},{default:s(()=>[u(w,{class:"page-title"},{default:s(()=>[f("ç»Ÿè®¡åˆ†æ")]),_:1}),u(w,{class:"page-subtitle"},{default:s(()=>[f("æŸ¥çœ‹æ–‡æ¡£å¤„ç†ç»Ÿè®¡æ•°æ®å’Œè¶‹åŠ¿åˆ†æ")]),_:1})]),_:1}),o.isLoading?(d(),a(T,{key:0,class:"loading-section"},{default:s(()=>[u(T,{class:"loading-card"},{default:s(()=>[u(T,{class:"loading-spinner"}),u(w,{class:"loading-text"},{default:s(()=>[f("æ­£åœ¨åŠ è½½ç»Ÿè®¡æ•°æ®...")]),_:1})]),_:1})]),_:1})):m("",!0),u(T,{class:"statistics-container"},{default:s(()=>[u(T,{class:"time-filter-section"},{default:s(()=>[u(T,{class:"filter-card"},{default:s(()=>[u(T,{class:"filter-header"},{default:s(()=>[u(w,{class:"filter-title"},{default:s(()=>[f("æ—¶é—´èŒƒå›´")]),_:1})]),_:1}),u(T,{class:"time-buttons"},{default:s(()=>[(d(!0),g(p,null,v(o.timePeriods,e=>(d(),a(M,{key:e.value,class:y(["time-btn",{active:o.selectedPeriod===e.value}]),onClick:t=>r.selectTimePeriod(e.value)},{default:s(()=>[u(w,{class:"btn-text"},{default:s(()=>[f(D(e.label),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1})]),_:1}),u(T,{class:"overview-section"},{default:s(()=>[u(T,{class:"overview-card"},{default:s(()=>[u(T,{class:"overview-header"},{default:s(()=>[u(w,{class:"overview-title"},{default:s(()=>[f("æ–‡æ¡£ç±»å‹ç»Ÿè®¡")]),_:1}),u(w,{class:"overview-subtitle"},{default:s(()=>[f(D(r.getTimeRangeText()),1)]),_:1})]),_:1}),u(T,{class:"overview-stats"},{default:s(()=>[u(T,{class:"stat-item"},{default:s(()=>[u(w,{class:"stat-number"},{default:s(()=>[f(D(r.totalDocuments),1)]),_:1}),u(w,{class:"stat-label"},{default:s(()=>[f("æ€»æ–‡æ¡£æ•°")]),_:1})]),_:1}),u(T,{class:"stat-item"},{default:s(()=>[u(w,{class:"stat-number"},{default:s(()=>[f(D(r.successCount),1)]),_:1}),u(w,{class:"stat-label"},{default:s(()=>[f("æˆåŠŸæå–")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),u(T,{class:"type-stats-section"},{default:s(()=>[u(T,{class:"type-stats-card"},{default:s(()=>[u(T,{class:"section-title"},{default:s(()=>[u(w,{class:"title-text"},{default:s(()=>[f("å„ç±»å‹æ–‡æ¡£æ•°é‡")]),_:1})]),_:1}),u(T,{class:"chart-container"},{default:s(()=>[u(T,{class:"pie-chart-wrapper"},{default:s(()=>[u(T,{class:"pie-chart",ref:"pieChart"},{default:s(()=>[u(T,{class:"chart-center"},{default:s(()=>[u(w,{class:"center-number"},{default:s(()=>[f(D(r.successCount),1)]),_:1}),u(w,{class:"center-label"},{default:s(()=>[f("æ€»è®¡")]),_:1})]),_:1}),o.hoveredSegment?(d(),a(T,{key:0,class:"hover-info",style:S({left:o.hoverPosition.x+"px",top:o.hoverPosition.y+"px"})},{default:s(()=>[u(w,{class:"hover-type"},{default:s(()=>[f(D(o.hoveredSegment.name),1)]),_:1}),u(w,{class:"hover-count"},{default:s(()=>[f(D(o.hoveredSegment.count)+" ä»½",1)]),_:1}),u(w,{class:"hover-percentage"},{default:s(()=>[f(D(o.hoveredSegment.percentage)+"%",1)]),_:1})]),_:1},8,["style"])):m("",!0)]),_:1},512),(d(),g("svg",{class:"pie-svg",viewBox:"0 0 220 220",onMouseleave:t[2]||(t[2]=(...e)=>r.clearHover&&r.clearHover(...e))},[P("g",{transform:"translate(110,110)"},[(d(!0),g(p,null,v(r.chartSegments,(e,a)=>(d(),g("path",{key:`segment-${e.id}-${a}`,d:e.isHovered?e.hoverPath:e.path,fill:e.color,stroke:e.isHovered?"#fff":"transparent","stroke-width":e.isHovered?"2":"0",opacity:e.opacity,class:y(["pie-segment",{animating:o.isAnimating}]),onMouseenter:t=>r.onSegmentHover(e,t),onMousemove:t[0]||(t[0]=e=>r.onSegmentMove(e)),onMouseleave:t[1]||(t[1]=(...e)=>r.clearHover&&r.clearHover(...e))},null,42,["d","fill","stroke","stroke-width","opacity","onMouseenter"]))),128))])],32))]),_:1}),u(T,{class:"chart-legend"},{default:s(()=>[(d(!0),g(p,null,v(r.chartSegments,(e,t)=>(d(),a(T,{key:t,class:"legend-item",onMouseenter:t=>r.onLegendHover(e),onMouseleave:r.clearHover},{default:s(()=>[u(T,{class:"legend-color",style:S({backgroundColor:e.color})},null,8,["style"]),u(T,{class:"legend-text"},{default:s(()=>[u(w,{class:"legend-name"},{default:s(()=>[f(D(e.name),1)]),_:2},1024),u(w,{class:"legend-count"},{default:s(()=>[f(D(e.count)+" ä»½ ("+D(e.percentage)+"%)",1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onMouseenter","onMouseleave"]))),128))]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}],["__scopeId","data-v-fc3388a9"]]);export{b as default};
