# 用户信息更新前端API接口使用指南

## 概览

本文档介绍了简洁的用户信息更新前端API接口，专门用于处理用户基本信息的更新操作。这些接口已经集成在用户设置页面中，提供了简单易用的用户信息管理功能。

## 核心功能

### 1. 更新用户基本信息 (用户名和邮箱)

**接口**: `PUT /api/v1/users/profile`

**使用方法**:
```javascript
// 在设置页面中调用
await this.updateUserProfile({
  username: "新用户名", 
  email: "new@email.com"
})
```

**特点**:
- 简化的请求参数，只包含用户名和邮箱
- 自动更新本地用户信息缓存
- 统一的错误处理
- JWT认证支持

### 2. 上传头像

**接口**: `POST /api/v1/users/avatar`

**使用方法**:
```javascript
// 选择图片后自动上传
await this.uploadAvatar(fileObject)
```

**特点**:
- 支持多种图片格式 (jpg, jpeg, png, gif, webp)
- 最大文件大小: 5MB
- 自动生成多种尺寸的头像
- 实时更新用户界面

### 3. 修改密码

**接口**: `PUT /api/v1/users/password`

**使用方法**:
```javascript
await this.changeUserPassword(
  "当前密码", 
  "新密码", 
  "确认新密码"
)
```

**特点**:
- 密码强度验证
- 密码确认验证
- 修改后自动清除token并要求重新登录
- 安全的密码处理

### 4. 便捷函数

#### 只更新用户名
```javascript
await this.updateUsername("新用户名")
```

#### 只更新邮箱
```javascript
await this.updateEmail("new@email.com")
```

#### 同时更新用户名和邮箱
```javascript
await this.updateUsernameAndEmail("新用户名", "new@email.com")
```

## 快速更新功能

用户设置页面还提供了快速更新按钮，允许用户通过弹窗快速修改单个字段：

### 快速更新用户名
- 点击"更新用户名"按钮
- 在弹窗中输入新用户名
- 自动验证并更新

### 快速更新邮箱
- 点击"更新邮箱"按钮
- 在弹窗中输入新邮箱地址
- 自动验证邮箱格式并更新

## API接口详细说明

### 请求格式

所有接口都需要在请求头中包含有效的JWT token：

```javascript
{
  'Authorization': 'Bearer your-jwt-token',
  'Content-Type': 'application/json'
}
```

### 响应格式

统一的响应格式：

```json
{
  "success": true,
  "code": 200,
  "message": "操作成功",
  "data": {
    // 具体数据
  }
}
```

### 错误处理

所有接口都包含统一的错误处理：

```javascript
try {
  await this.updateUserProfile(profileData)
  uni.showToast({
    title: '更新成功',
    icon: 'success'
  })
} catch (error) {
  uni.showToast({
    title: error.message || '更新失败',
    icon: 'none'
  })
}
```

## 使用示例

### 完整的用户信息更新流程

```javascript
// 1. 获取当前用户信息
const currentUser = getCurrentUser()

// 2. 更新用户信息
try {
  await this.updateUserProfile({
    username: "newusername",
    email: "newemail@example.com"
  })
  console.log('用户信息更新成功')
} catch (error) {
  console.error('更新失败:', error.message)
}

// 3. 上传新头像
try {
  const res = await uni.chooseImage({
    count: 1,
    sizeType: ['compressed']
  })
  
  await this.uploadAvatar(res.tempFilePaths[0])
  console.log('头像上传成功')
} catch (error) {
  console.error('头像上传失败:', error.message)
}

// 4. 修改密码
try {
  await this.changeUserPassword(
    "currentPassword",
    "newPassword123",
    "newPassword123"
  )
  console.log('密码修改成功，需要重新登录')
} catch (error) {
  console.error('密码修改失败:', error.message)
}
```

### 批量更新示例

```javascript
// 使用便捷函数进行批量更新
const updateTasks = [
  this.updateUsername("新用户名"),
  this.updateEmail("new@email.com")
]

try {
  await Promise.all(updateTasks)
  console.log('所有信息更新成功')
} catch (error) {
  console.error('批量更新失败:', error.message)
}
```

## 安全考虑

1. **JWT认证**: 所有接口都需要有效的JWT token
2. **密码安全**: 密码修改后会自动清除所有token
3. **数据验证**: 前端和后端都进行数据格式验证
4. **错误处理**: 不会泄露敏感的错误信息

## 注意事项

1. **网络错误**: 接口调用失败时会自动显示错误提示
2. **本地缓存**: 成功更新后会自动更新本地用户信息缓存
3. **重新登录**: 密码修改成功后需要重新登录
4. **文件大小**: 头像文件不能超过5MB
5. **邮箱格式**: 邮箱地址必须符合标准格式

## 技术实现

这些接口基于以下技术栈实现：

- **前端框架**: uni-app
- **HTTP客户端**: 基于uni.request的封装
- **状态管理**: 本地存储 + Vuex
- **错误处理**: 统一的错误处理机制
- **认证**: JWT token认证

## 更新日志

### v1.0.0 (2025-01-15)
- ✅ 实现基本的用户信息更新功能
- ✅ 添加头像上传功能
- ✅ 实现密码修改功能
- ✅ 添加便捷更新函数
- ✅ 集成快速更新UI组件
- ✅ 完善错误处理和用户提示

---

*本文档最后更新时间: 2025-01-15*









