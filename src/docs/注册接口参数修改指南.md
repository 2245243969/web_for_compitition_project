# 注册接口参数修改指南

## 📋 修改概述

根据后端API要求，注册接口的参数结构需要进行调整，移除 `firstName` 和 `lastName` 字段，添加 `confirmPassword` 和 `agreeTerms` 字段。

## 🔄 参数变更对比

### 修改前
```javascript
const registerData = {
    email: 'user@example.com',
    password: 'password123',
    username: 'username',
    firstName: '名',           // ❌ 已移除
    lastName: '姓'             // ❌ 已移除
}
```

### 修改后 ✅
```javascript
const registerData = {
    username: 'wyz',                    // ✅ 用户名，2-20字符
    email: '224524396@qq.com',          // ✅ 邮箱地址，必须唯一  
    password: '2483608zyw',             // ✅ 密码，至少6位
    confirmPassword: '2483608zyw',      // ✅ 新增：确认密码
    agreeTerms: true                    // ✅ 新增：同意条款
}
```

## ⚠️ 验证规则说明

根据后端代码，注册时会进行以下验证：

### 1. 用户名验证
- **长度**: 2-20字符
- **唯一性**: 不能与现有用户重复
- **格式**: 无特殊格式要求

### 2. 邮箱验证  
- **格式**: 有效邮箱格式 (包含@和域名)
- **唯一性**: 不能与现有用户重复

### 3. 密码验证
- **长度**: 至少6位
- **一致性**: `password` 与 `confirmPassword` 必须一致

### 4. 协议同意
- **必填**: `agreeTerms` 必须为 `true`

## ✅ 已完成的修改

### 1. API层修改

**文件**: `src/utils/api.js`
```javascript
// 修改前
const requestData = {
    email: registerData.email,
    password: registerData.password,
    username: registerData.username,
    firstName: registerData.firstName || '',
    lastName: registerData.lastName || ''
}

// 修改后 ✅
const requestData = {
    username: registerData.username,
    email: registerData.email,
    password: registerData.password,
    confirmPassword: registerData.confirmPassword,
    agreeTerms: registerData.agreeTerms
}
```

### 2. 类型定义修改

**文件**: `src/types/api.ts`
```typescript
// 修改后 ✅
export interface RegisterRequest {
  username: string;        // 用户名，2-20字符，必须唯一
  email: string;          // 邮箱地址，必须是有效格式且唯一  
  password: string;       // 密码，至少6位
  confirmPassword: string; // 确认密码，必须与password一致
  agreeTerms: boolean;    // 同意条款，必须为true
}
```

### 3. 前端页面修改

**文件**: `src/pages/login/login.vue`

#### 3.1 表单数据结构
```javascript
registerForm: {
    username: '',
    email: '',
    password: '',
    confirmPassword: '',
    agreeTerms: false  // ✅ 新增字段
}
```

#### 3.2 添加同意条款UI
```vue
<!-- 同意条款复选框 -->
<view class="form-group">
  <label class="checkbox-wrapper agreement-wrapper">
    <checkbox 
      class="checkbox" 
      :checked="registerForm.agreeTerms" 
      @change="onAgreeTermsChange"
    />
    <text class="checkbox-text">
      我已阅读并同意
      <text class="link-text" @click="showTerms">《用户服务协议》</text>
      和
      <text class="link-text" @click="showPrivacy">《隐私政策》</text>
    </text>
  </label>
  <text v-if="registerErrors.agreeTerms" class="error-text">
    {{ registerErrors.agreeTerms }}
  </text>
</view>
```

#### 3.3 验证规则更新
```javascript
// 用户名长度验证
if (!this.registerForm.username.trim()) {
    errors.username = '请输入用户名'
} else if (this.registerForm.username.length < 2) {
    errors.username = '用户名至少2个字符'
} else if (this.registerForm.username.length > 20) {  // ✅ 新增长度上限
    errors.username = '用户名不能超过20个字符'
}

// 同意条款验证 
if (!this.registerForm.agreeTerms) {  // ✅ 新增验证
    errors.agreeTerms = '请阅读并同意用户服务协议和隐私政策'
}
```

#### 3.4 事件处理方法
```javascript
// 同意条款选择变化
onAgreeTermsChange(e) {
    this.registerForm.agreeTerms = e.detail.value.length > 0
},

// 显示用户服务协议
showTerms() {
    uni.showModal({
        title: '用户服务协议',
        content: '这里是用户服务协议的内容...',
        confirmText: '我知道了'
    })
},

// 显示隐私政策  
showPrivacy() {
    uni.showModal({
        title: '隐私政策', 
        content: '这里是隐私政策的内容...',
        confirmText: '我知道了'
    })
}
```

### 4. 示例代码修改

**文件**: `src/examples/api-usage-examples.js`
```javascript
// 完整的注册示例 ✅
const registerData = {
    username: 'wyz',                    // 用户名，2-20字符
    email: '224524396@qq.com',          // 邮箱地址，必须唯一
    password: '2483608zyw',             // 密码，至少6位
    confirmPassword: '2483608zyw',      // 确认密码，必须一致  
    agreeTerms: true                    // 同意条款，必须为true
}
```

## 🎯 功能特性

### ✅ 新增功能

1. **确认密码验证**: 确保用户输入密码的准确性
2. **同意条款**: 法律合规要求，用户必须明确同意服务条款
3. **用户名长度限制**: 防止过长的用户名影响显示
4. **协议链接**: 提供服务协议和隐私政策的查看入口

### ✅ 优化体验

1. **实时验证**: 表单字段实时验证，即时反馈错误
2. **友好提示**: 清晰的错误提示信息
3. **样式适配**: 同意条款区域的专门样式优化
4. **状态管理**: 正确的表单状态管理和重置

## 🧪 测试验证

### 成功注册测试
```javascript
const validRegister = {
    username: 'testuser',
    email: 'test@example.com', 
    password: 'password123',
    confirmPassword: 'password123',
    agreeTerms: true
}
```

### 验证失败测试
```javascript
// 1. 用户名过短
{ username: 'a', ... }  // 错误: 用户名至少2个字符

// 2. 用户名过长
{ username: 'verylongusernamethatexceeds20chars', ... }  // 错误: 不能超过20个字符

// 3. 密码不一致
{ password: 'pass1', confirmPassword: 'pass2', ... }  // 错误: 两次输入的密码不一致

// 4. 未同意条款
{ agreeTerms: false, ... }  // 错误: 请阅读并同意用户服务协议和隐私政策
```

## 📱 UI展示

注册表单现在包含以下字段：

1. **用户名** - 文本输入框 (2-20字符)
2. **邮箱** - 邮箱输入框 (验证格式)
3. **密码** - 密码输入框 (至少6位，带显示切换)
4. **确认密码** - 密码输入框 (与密码一致，带显示切换)
5. **同意条款** - 复选框 + 协议链接 (必须勾选)
6. **注册按钮** - 提交按钮 (验证通过后可点击)

## 💡 注意事项

### 1. 向后兼容
- API层做了兼容处理，支持新旧格式
- 前端完全使用新格式，确保与后端一致

### 2. 用户体验
- 同意条款使用模态框展示，实际项目中应链接到完整页面
- 错误提示清晰明确，帮助用户快速定位问题

### 3. 安全性
- 前端验证主要用于用户体验，安全验证依然在后端
- 密码确认减少用户输入错误的可能性

### 4. 法律合规
- 用户注册必须明确同意服务条款
- 建议在生产环境中提供完整的法律文件链接

---

**修改时间**: 2025-01-15  
**影响范围**: 用户注册功能  
**兼容性**: 与后端API完全兼容  
**状态**: ✅ 修改完成，可直接使用

