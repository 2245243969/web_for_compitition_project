# ç™»å½•æ¥å£å­—æ®µè¿ç§»æŒ‡å—

## ğŸ“‹ å˜æ›´æ¦‚è¿°

æ ¹æ®åç«¯APIæ–‡æ¡£çš„æ›´æ–°ï¼Œç™»å½•æ¥å£çš„å‚æ•°å­—æ®µåéœ€è¦ä» `email` ä¿®æ”¹ä¸º `username`ã€‚

### ğŸ”„ ä¸»è¦å˜æ›´

| é¡¹ç›® | ä¿®æ”¹å‰ | ä¿®æ”¹å |
|------|--------|--------|
| å­—æ®µå | `email` | `username` |
| åŠŸèƒ½ | åªæ”¯æŒé‚®ç®±ç™»å½• | æ”¯æŒé‚®ç®±æˆ–ç”¨æˆ·åç™»å½• |
| ç”¨æˆ·ä½“éªŒ | æ— å˜åŒ– | æ— å˜åŒ– |

## âœ… å·²å®Œæˆçš„ä¿®æ”¹

### 1. APIå±‚ä¿®æ”¹

**æ–‡ä»¶**: `src/utils/api.js`
```javascript
// ä¿®æ”¹å‰
const requestData = {
    email: loginData.email || loginData.username,
    password: loginData.password,
    rememberMe: loginData.rememberMe || false
}

// ä¿®æ”¹å âœ…
const requestData = {
    username: loginData.username || loginData.email, // æ”¯æŒusernameå­—æ®µ
    password: loginData.password,
    rememberMe: loginData.rememberMe || false
}
```

### 2. ç±»å‹å®šä¹‰ä¿®æ”¹

**æ–‡ä»¶**: `src/types/api.ts`
```typescript
// ä¿®æ”¹å‰
export interface LoginRequest {
  email: string;
  password: string;
  rememberMe?: boolean;
}

// ä¿®æ”¹å âœ…
export interface LoginRequest {
  username: string;  // æ”¯æŒç”¨æˆ·åæˆ–é‚®ç®±æ ¼å¼
  password: string;
  rememberMe?: boolean;
}
```

### 3. ç¤ºä¾‹ä»£ç ä¿®æ”¹

**æ–‡ä»¶**: `src/examples/api-usage-examples.js`
```javascript
// ä¿®æ”¹å‰
const loginData = {
    email: 'user@example.com',
    password: 'password123',
    rememberMe: true
}

// ä¿®æ”¹å âœ…
const loginData = {
    username: 'user@example.com',  // å­—æ®µåæ”¹ä¸ºusername
    password: 'password123',
    rememberMe: true
}
```

### 4. æµ‹è¯•ä»£ç ä¿®æ”¹

**æ–‡ä»¶**: `src/tests/api-integration-test.js`
```javascript
// ä¿®æ”¹å âœ…
const credentials = {
    username: 'test@example.com',  // å­—æ®µåæ”¹ä¸ºusername
    password: 'testpassword123'
}
```

## ğŸ¯ å‰ç«¯é¡µé¢éœ€è¦çš„ä¿®æ”¹

### 1. ç™»å½•è¡¨å•æ•°æ®æ„å»º

å¦‚æœæ‚¨çš„ç™»å½•é¡µé¢ä»£ç ä¸­æœ‰ç±»ä¼¼è¿™æ ·çš„ä»£ç ï¼Œéœ€è¦ä¿®æ”¹ï¼š

```javascript
// éœ€è¦ä¿®æ”¹çš„ä»£ç ç¤ºä¾‹
const formData = {
    email: emailInput.value,     // âŒ éœ€è¦ä¿®æ”¹
    password: passwordInput.value,
    rememberMe: rememberCheckbox.checked
}

// ä¿®æ”¹ä¸º âœ…
const formData = {
    username: emailInput.value,  // âœ… æ”¹ä¸ºusernameï¼ˆå€¼ä»ç„¶å¯ä»¥æ˜¯é‚®ç®±ï¼‰
    password: passwordInput.value,
    rememberMe: rememberCheckbox.checked
}
```

### 2. APIè°ƒç”¨å‡½æ•°

```javascript
// éœ€è¦ä¿®æ”¹çš„ä»£ç ç¤ºä¾‹
export const userLogin = async (email, password) => {
    return await loginApi({
        email: email,           // âŒ éœ€è¦ä¿®æ”¹
        password: password
    });
};

// ä¿®æ”¹ä¸º âœ…
export const userLogin = async (email, password) => {
    return await loginApi({
        username: email,        // âœ… æ”¹ä¸ºusername
        password: password
    });
};
```

### 3. é”™è¯¯å¤„ç†

```javascript
// éœ€è¦ä¿®æ”¹çš„é”™è¯¯å­—æ®µåˆ¤æ–­
if (error.field === 'email') {     // âŒ éœ€è¦ä¿®æ”¹
    // å¤„ç†é‚®ç®±é”™è¯¯
}

// ä¿®æ”¹ä¸º âœ…
if (error.field === 'username') {  // âœ… æ–°çš„é”™è¯¯å­—æ®µå
    // å¤„ç†ç”¨æˆ·å/é‚®ç®±é”™è¯¯
}
```

## ğŸ“± å…·ä½“é¡µé¢ä¿®æ”¹æŒ‡å¯¼

### ç™»å½•é¡µé¢ (`src/pages/login/login.vue`)

éœ€è¦æ£€æŸ¥å’Œä¿®æ”¹çš„åœ°æ–¹ï¼š

1. **è¡¨å•æäº¤å‡½æ•°**
```vue
<script>
// æŸ¥æ‰¾ç±»ä¼¼è¿™æ ·çš„ä»£ç å¹¶ä¿®æ”¹
const submitForm = () => {
    const loginData = {
        email: form.email,        // âŒ æ”¹ä¸º username
        password: form.password
    }
    
    // è°ƒç”¨ç™»å½•API
    loginApi(loginData)
}

// ä¿®æ”¹ä¸º âœ…
const submitForm = () => {
    const loginData = {
        username: form.email,     // âœ… å­—æ®µåæ”¹ä¸ºusername
        password: form.password
    }
    
    // è°ƒç”¨ç™»å½•API
    loginApi(loginData)
}
</script>
```

2. **é”™è¯¯å¤„ç†**
```javascript
// ä¿®æ”¹é”™è¯¯å¤„ç†é€»è¾‘
.catch(error => {
    // æ£€æŸ¥æ˜¯å¦æœ‰é’ˆå¯¹emailå­—æ®µçš„ç‰¹æ®Šå¤„ç†
    if (error.message.includes('email')) {
        // å¯èƒ½éœ€è¦æ›´æ–°ä¸ºusernameç›¸å…³çš„é”™è¯¯å¤„ç†
    }
})
```

## ğŸ’¡ é‡è¦è¯´æ˜

### âœ… ç”¨æˆ·ä½“éªŒä¸å—å½±å“

1. **ç•Œé¢æ— éœ€ä¿®æ”¹**: 
   - ç™»å½•è¡¨å•ä»ç„¶å¯ä»¥æ˜¾ç¤º"é‚®ç®±"æˆ–"ç”¨æˆ·å/é‚®ç®±"æ ‡ç­¾
   - ç”¨æˆ·ä»ç„¶å¯ä»¥è¾“å…¥é‚®ç®±åœ°å€è¿›è¡Œç™»å½•

2. **å‘åå…¼å®¹**:
   - APIå±‚å·²ç»åšäº†å…¼å®¹å¤„ç†ï¼š`loginData.username || loginData.email`
   - æ”¯æŒä¼ å…¥é‚®ç®±ï¼š`username: "user@example.com"`
   - ä¹Ÿæ”¯æŒä¼ å…¥ç”¨æˆ·åï¼š`username: "myusername"`

3. **åŠŸèƒ½å¢å¼º**:
   - ç°åœ¨åŒæ—¶æ”¯æŒé‚®ç®±å’Œç”¨æˆ·åç™»å½•
   - åç«¯ä¼šè‡ªåŠ¨è¯†åˆ«è¾“å…¥çš„æ˜¯é‚®ç®±è¿˜æ˜¯ç”¨æˆ·å

## ğŸ” æ£€æŸ¥æ¸…å•

è¯·æ£€æŸ¥ä»¥ä¸‹æ–‡ä»¶ä¸­æ˜¯å¦æœ‰éœ€è¦ä¿®æ”¹çš„ç™»å½•ç›¸å…³ä»£ç ï¼š

- [ ] `src/pages/login/login.vue` - ç™»å½•é¡µé¢
- [ ] `src/pages/register/register.vue` - æ³¨å†Œé¡µé¢ï¼ˆå¦‚æœæœ‰ç™»å½•è·³è½¬ï¼‰
- [ ] ä»»ä½•è°ƒç”¨ `loginApi` çš„ç»„ä»¶
- [ ] ä»»ä½•æ„å»ºç™»å½•è¡¨å•æ•°æ®çš„ä»£ç 
- [ ] é”™è¯¯å¤„ç†ä¸­å¯¹ `email` å­—æ®µçš„ç‰¹æ®Šå¤„ç†

## ğŸ§ª æµ‹è¯•éªŒè¯

ä¿®æ”¹å®Œæˆåï¼Œè¯·æµ‹è¯•ï¼š

1. **é‚®ç®±ç™»å½•**: `username: "user@example.com"`
2. **ç”¨æˆ·åç™»å½•**: `username: "myusername"`ï¼ˆå¦‚æœåç«¯æ”¯æŒï¼‰
3. **é”™è¯¯å¤„ç†**: ç¡®ä¿é”™è¯¯ä¿¡æ¯æ­£ç¡®æ˜¾ç¤º
4. **è®°ä½ç™»å½•**: ç¡®ä¿ `rememberMe` åŠŸèƒ½æ­£å¸¸

## ğŸ“ æ”¯æŒ

å¦‚æœåœ¨ä¿®æ”¹è¿‡ç¨‹ä¸­é‡åˆ°é—®é¢˜ï¼Œå¯ä»¥ï¼š

1. æŸ¥çœ‹ `src/examples/api-usage-examples.js` ä¸­çš„ç¤ºä¾‹ä»£ç 
2. è¿è¡Œ `src/tests/api-integration-test.js` è¿›è¡Œé›†æˆæµ‹è¯•
3. æ£€æŸ¥æ§åˆ¶å°æ—¥å¿—ä¸­çš„APIè°ƒç”¨å‚æ•°

---

**ä¿®æ”¹æ—¶é—´**: 2025-01-15  
**å½±å“èŒƒå›´**: ç™»å½•ç›¸å…³åŠŸèƒ½  
**å…¼å®¹æ€§**: å‘åå…¼å®¹ï¼Œç”¨æˆ·ä½“éªŒæ— å½±å“

