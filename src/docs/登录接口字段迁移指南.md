# 登录接口字段迁移指南

## 📋 变更概述

根据后端API文档的更新，登录接口的参数字段名需要从 `email` 修改为 `username`。

### 🔄 主要变更

| 项目 | 修改前 | 修改后 |
|------|--------|--------|
| 字段名 | `email` | `username` |
| 功能 | 只支持邮箱登录 | 支持邮箱或用户名登录 |
| 用户体验 | 无变化 | 无变化 |

## ✅ 已完成的修改

### 1. API层修改

**文件**: `src/utils/api.js`
```javascript
// 修改前
const requestData = {
    email: loginData.email || loginData.username,
    password: loginData.password,
    rememberMe: loginData.rememberMe || false
}

// 修改后 ✅
const requestData = {
    username: loginData.username || loginData.email, // 支持username字段
    password: loginData.password,
    rememberMe: loginData.rememberMe || false
}
```

### 2. 类型定义修改

**文件**: `src/types/api.ts`
```typescript
// 修改前
export interface LoginRequest {
  email: string;
  password: string;
  rememberMe?: boolean;
}

// 修改后 ✅
export interface LoginRequest {
  username: string;  // 支持用户名或邮箱格式
  password: string;
  rememberMe?: boolean;
}
```

### 3. 示例代码修改

**文件**: `src/examples/api-usage-examples.js`
```javascript
// 修改前
const loginData = {
    email: 'user@example.com',
    password: 'password123',
    rememberMe: true
}

// 修改后 ✅
const loginData = {
    username: 'user@example.com',  // 字段名改为username
    password: 'password123',
    rememberMe: true
}
```

### 4. 测试代码修改

**文件**: `src/tests/api-integration-test.js`
```javascript
// 修改后 ✅
const credentials = {
    username: 'test@example.com',  // 字段名改为username
    password: 'testpassword123'
}
```

## 🎯 前端页面需要的修改

### 1. 登录表单数据构建

如果您的登录页面代码中有类似这样的代码，需要修改：

```javascript
// 需要修改的代码示例
const formData = {
    email: emailInput.value,     // ❌ 需要修改
    password: passwordInput.value,
    rememberMe: rememberCheckbox.checked
}

// 修改为 ✅
const formData = {
    username: emailInput.value,  // ✅ 改为username（值仍然可以是邮箱）
    password: passwordInput.value,
    rememberMe: rememberCheckbox.checked
}
```

### 2. API调用函数

```javascript
// 需要修改的代码示例
export const userLogin = async (email, password) => {
    return await loginApi({
        email: email,           // ❌ 需要修改
        password: password
    });
};

// 修改为 ✅
export const userLogin = async (email, password) => {
    return await loginApi({
        username: email,        // ✅ 改为username
        password: password
    });
};
```

### 3. 错误处理

```javascript
// 需要修改的错误字段判断
if (error.field === 'email') {     // ❌ 需要修改
    // 处理邮箱错误
}

// 修改为 ✅
if (error.field === 'username') {  // ✅ 新的错误字段名
    // 处理用户名/邮箱错误
}
```

## 📱 具体页面修改指导

### 登录页面 (`src/pages/login/login.vue`)

需要检查和修改的地方：

1. **表单提交函数**
```vue
<script>
// 查找类似这样的代码并修改
const submitForm = () => {
    const loginData = {
        email: form.email,        // ❌ 改为 username
        password: form.password
    }
    
    // 调用登录API
    loginApi(loginData)
}

// 修改为 ✅
const submitForm = () => {
    const loginData = {
        username: form.email,     // ✅ 字段名改为username
        password: form.password
    }
    
    // 调用登录API
    loginApi(loginData)
}
</script>
```

2. **错误处理**
```javascript
// 修改错误处理逻辑
.catch(error => {
    // 检查是否有针对email字段的特殊处理
    if (error.message.includes('email')) {
        // 可能需要更新为username相关的错误处理
    }
})
```

## 💡 重要说明

### ✅ 用户体验不受影响

1. **界面无需修改**: 
   - 登录表单仍然可以显示"邮箱"或"用户名/邮箱"标签
   - 用户仍然可以输入邮箱地址进行登录

2. **向后兼容**:
   - API层已经做了兼容处理：`loginData.username || loginData.email`
   - 支持传入邮箱：`username: "user@example.com"`
   - 也支持传入用户名：`username: "myusername"`

3. **功能增强**:
   - 现在同时支持邮箱和用户名登录
   - 后端会自动识别输入的是邮箱还是用户名

## 🔍 检查清单

请检查以下文件中是否有需要修改的登录相关代码：

- [ ] `src/pages/login/login.vue` - 登录页面
- [ ] `src/pages/register/register.vue` - 注册页面（如果有登录跳转）
- [ ] 任何调用 `loginApi` 的组件
- [ ] 任何构建登录表单数据的代码
- [ ] 错误处理中对 `email` 字段的特殊处理

## 🧪 测试验证

修改完成后，请测试：

1. **邮箱登录**: `username: "user@example.com"`
2. **用户名登录**: `username: "myusername"`（如果后端支持）
3. **错误处理**: 确保错误信息正确显示
4. **记住登录**: 确保 `rememberMe` 功能正常

## 📞 支持

如果在修改过程中遇到问题，可以：

1. 查看 `src/examples/api-usage-examples.js` 中的示例代码
2. 运行 `src/tests/api-integration-test.js` 进行集成测试
3. 检查控制台日志中的API调用参数

---

**修改时间**: 2025-01-15  
**影响范围**: 登录相关功能  
**兼容性**: 向后兼容，用户体验无影响

