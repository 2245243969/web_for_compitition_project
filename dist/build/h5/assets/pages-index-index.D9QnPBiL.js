import{g as e,_ as s,S as t,c as a,w as o,s as l,a as n,b as c,d as r,n as i,h as d,e as u,f as m,r as g,i as f,j as p,o as y,k as _,l as T,m as w,p as h,F as v,q as x,t as S,u as b}from"./index-CKATG7UM.js";const k=s({components:{Sidebar:t},data:()=>({systemStats:{totalDocuments:0,todayDocuments:0,successRate:0,averageProcessTime:0,systemPerformance:0,documentTypes:[]},isLoadingStats:!0,totalUsers:0,recentHistory:[]}),onShow(){console.log("📱 首页重新显示，刷新最近历史记录"),this.loadRecentHistory()},onLoad(){console.log("Index page loaded"),this.setupErrorHandling();const s=e("isLoggedIn"),t=e("token");if(console.log("🔍 页面加载检查:",{isLoggedIn:s,hasToken:!!t,tokenLength:t?t.length:0}),!s||!t)return console.log("❌ 未登录，跳转到登录页"),void g({url:"/pages/login/login"});console.log("✅ 用户已登录，开始调试"),setTimeout(async()=>{!function(){const s=e("token"),t=e("isLoggedIn"),a=e("userInfo");if(console.group("🔍 认证状态调试信息"),console.log("登录状态:",t),console.log("Token存在:",!!s),console.log("Token长度:",s?s.length:0),console.log("Token前20字符:",s?s.substring(0,20)+"...":"null"),console.log("用户信息:",a),s)try{const e=s.split(".");if(3===e.length){const s=JSON.parse(atob(e[0])),t=JSON.parse(atob(e[1]));console.log("JWT Header:",s),console.log("JWT Payload:",t),console.log("JWT过期时间:",t.exp?new Date(1e3*t.exp):"未设置"),console.log("当前时间:",new Date),console.log("Token是否过期:",t.exp?1e3*t.exp<Date.now():"无法判断")}}catch(o){console.log("Token不是标准JWT格式或解析失败")}console.groupEnd()}(),this.loadSystemStats(),this.loadRecentHistory()},300)},methods:{setupErrorHandling(){if("undefined"!=typeof window){const e=window.onunhandledrejection;window.onunhandledrejection=s=>s.reason&&"string"==typeof s.reason&&(s.reason.includes("Pro feature")||s.reason.includes("content_script")||s.reason.includes("extension")||s.reason.includes("chrome-extension")||s.reason.includes("moz-extension"))?(console.warn("🔧 检测到浏览器扩展错误，已忽略:",s.reason),void s.preventDefault()):s.reason&&s.reason.stack&&(s.reason.stack.includes("content_script")||s.reason.stack.includes("extension")||s.reason.stack.includes("chrome-extension")||s.reason.stack.includes("moz-extension"))?(console.warn("🔧 检测到扩展程序错误，已忽略:",s.reason.message||s.reason),void s.preventDefault()):s.reason&&s.reason.message&&(s.reason.message.includes("ERR_EMPTY_RESPONSE")||s.reason.message.includes("ERR_CONNECTION_REFUSED")||s.reason.message.includes("request:fail")||s.reason.message.includes("Network Error"))?(console.warn("🌐 检测到网络连接错误，已处理:",s.reason.message),void s.preventDefault()):void(e&&e.call(window,s));const s=window.onerror;window.onerror=(e,t,a,o,l)=>t&&(t.includes("extension")||t.includes("content_script")||t.includes("chrome-extension")||t.includes("moz-extension"))?(console.warn("🔧 检测到扩展程序JS错误，已忽略:",e),!0):"string"==typeof e&&(e.includes("ERR_EMPTY_RESPONSE")||e.includes("ERR_CONNECTION_REFUSED")||e.includes("request:fail")||e.includes("Network Error"))?(console.warn("🌐 检测到网络错误，已处理:",e),!0):!!s&&s.call(window,e,t,a,o,l)}},async loadSystemStats(){var e;console.log("📊 开始加载系统统计..."),this.isLoadingStats=!0;try{const s=await m();s&&s.overview?(console.log("✅ 成功获取系统统计数据:",s),this.systemStats={totalDocuments:s.overview.totalDocuments||0,todayDocuments:(null==(e=s.periodStats)?void 0:e.documentsUploaded)||0,successRate:Math.round(s.overview.successRate||0),averageProcessTime:s.overview.averageProcessingTime||0,systemPerformance:Math.round(s.overview.systemHealth||95),documentTypes:s.documentTypes||[]}):s&&void 0!==s.totalDocuments?(console.log("✅ 获取系统统计数据（旧格式）:",s),this.systemStats={totalDocuments:s.totalDocuments||0,todayDocuments:s.todayDocuments||0,successRate:s.successRate||0,averageProcessTime:s.averageProcessTime||0,systemPerformance:s.systemPerformance||95,documentTypes:s.documentTypes||[]}):(console.log("📊 API无有效数据，使用默认数据"),this.useDefaultStats())}catch(s){s.message&&(s.message.includes("ERR_EMPTY_RESPONSE")||s.message.includes("ERR_CONNECTION_REFUSED")||s.message.includes("request:fail")||s.message.includes("Network Error")||s.message.includes("服务器内部错误"))?console.info("📊 后端服务暂时不可用，使用默认数据展示"):console.warn("📊 加载系统统计失败，使用默认数据:",s.message),this.useDefaultStats()}finally{this.isLoadingStats=!1}},async loadRecentHistory(){console.log("📋 开始加载最近处理历史记录...");try{const e=await u({page:1,pageSize:5});e&&e.records&&e.records.length>0?(console.log("✅ 成功获取最近历史记录:",e.records),this.recentHistory=e.records.map(e=>{var s,t,a,o,l;const n=e.extractedFields&&e.totalFields?Math.round(e.extractedFields/e.totalFields*100):0;return{id:e.id,taskId:(null==(t=null==(s=e.extractionTasks)?void 0:s[0])?void 0:t.id)||e.id,fileName:e.fileName||e.originalName||"未知文档",processTime:this.formatProcessTime(e.processingTime||(null==(o=null==(a=e.extractionTasks)?void 0:a[0])?void 0:o.processingTime)),status:(null==(l=e.status)?void 0:l.toLowerCase())||"unknown",accuracy:n,documentType:e.documentType,createdAt:e.createdAt}}),console.log("✅ 转换后的历史记录:",this.recentHistory)):(console.log("📋 暂无历史记录"),this.recentHistory=[])}catch(e){console.warn("📋 加载最近历史记录失败:",e.message),this.recentHistory=[]}},formatProcessTime(e){if(!e)return"0s";if(e<60)return`${e}s`;{const s=Math.floor(e/60),t=e%60;return t>0?`${s}m ${t}s`:`${s}m`}},useDefaultStats(){this.systemStats={totalDocuments:0,todayDocuments:0,successRate:0,averageProcessTime:0,systemPerformance:0,documentTypes:[]},this.isLoadingStats=!1},navigateToUpload(){i({url:"/pages/upload/upload"})},navigateToResults(){i({url:"/pages/results/results"})},navigateToStatistics(){i({url:"/pages/statistics/statistics"})},navigateToHistory(){i({url:"/pages/history/history"})},async viewHistoryDetail(e){if("completed"===e.status)try{n({title:"加载结果中...",mask:!0}),console.log("🔍 首页点击查看历史详情，记录信息:",e);const s=await c(e.id);if(!s)throw new Error("无法获取提取结果数据");{console.log("📥 从API获取的原始结果:",s);const t={id:s.id||e.taskId,taskId:s.taskId||e.taskId,documentId:s.documentId||e.id,status:s.status||"COMPLETED",progress:100,processingTime:s.processingTime||0,currentStep:"completed",extractedData:s.extractedData||{},extractionSummary:s.extractionSummary||{totalFields:this.getFixedTotalFieldsByType(e.documentType),extractedFields:e.accuracy?Math.round(e.accuracy*this.getFixedTotalFieldsByType(e.documentType)/100):0,documentType:e.documentType,processingTime:0,averageConfidence:.92,extractionRate:e.accuracy/100||0},qualityMetrics:s.qualityMetrics||{averageConfidence:.92,fieldCoverage:e.accuracy/100||0,processingTime:0},documentType:e.documentType,fileName:e.fileName,createdAt:s.createdAt||e.createdAt,completedAt:s.completedAt||e.createdAt};console.log("✅ 构建完整结果数据（与处理历史页面格式一致）:",t),r("currentExtractionResults",t),i({url:"/pages/results/results"})}}catch(s){console.error("❌ 加载历史详情失败:",s),l({title:s.message||"加载失败，请重试",icon:"none"})}finally{d()}else l({title:"该文件尚未处理完成，无法查看详情",icon:"none"})},getFixedTotalFieldsByType:e=>"fund_contract"===e?44:22,getStatusText:e=>({completed:"处理完成",processing:"处理中",failed:"处理失败",pending:"等待处理",error:"处理错误"}[e]||e)}},[["render",function(e,s,t,l,n,c){const r=p("Sidebar"),i=T,d=f;return y(),a(d,{class:"web-layout"},{default:o(()=>[_(r),_(d,{class:"web-content"},{default:o(()=>[_(d,{class:"content-wrapper"},{default:o(()=>[_(d,{class:"page-header fade-in-up"},{default:o(()=>[_(i,{class:"page-title"},{default:o(()=>[w("首页概览")]),_:1}),_(i,{class:"page-subtitle"},{default:o(()=>[w("欢迎使用基金发行公告提取系统，智能化基金文档信息提取与分析平台")]),_:1})]),_:1}),_(d,{class:"card-grid card-grid-3 fade-in-up"},{default:o(()=>[_(d,{class:"web-card card-primary",onClick:c.navigateToUpload},{default:o(()=>[_(d,{class:"card-header"},{default:o(()=>[_(i,{class:"card-title"},{default:o(()=>[w("文件上传")]),_:1}),_(i,{class:"card-icon"},{default:o(()=>[w("📤")]),_:1})]),_:1}),_(d,{class:"card-content"},{default:o(()=>[_(i,{class:"card-text"},{default:o(()=>[w("上传基金发行公告PDF文档")]),_:1}),_(d,{class:"web-button btn-accent",style:{"margin-top":"20rpx","margin-left":"180rpx"}},{default:o(()=>[_(i,null,{default:o(()=>[w("立即上传")]),_:1})]),_:1})]),_:1})]),_:1},8,["onClick"]),_(d,{class:"web-card",onClick:c.navigateToResults},{default:o(()=>[_(d,{class:"card-header"},{default:o(()=>[_(i,{class:"card-title"},{default:o(()=>[w("提取结果")]),_:1}),_(i,{class:"card-icon"},{default:o(()=>[w("📊")]),_:1})]),_:1}),_(d,{class:"card-content"},{default:o(()=>[_(i,{class:"card-text"},{default:o(()=>[w("查看最新的文档提取结果和分析报告")]),_:1}),_(d,{class:"web-button btn-outline",style:{"margin-top":"20rpx","margin-left":"60rpx"}},{default:o(()=>[_(i,null,{default:o(()=>[w("查看结果")]),_:1})]),_:1})]),_:1})]),_:1},8,["onClick"]),_(d,{class:"web-card",onClick:c.navigateToStatistics},{default:o(()=>[_(d,{class:"card-header"},{default:o(()=>[_(i,{class:"card-title"},{default:o(()=>[w("统计分析")]),_:1}),_(i,{class:"card-icon"},{default:o(()=>[w("📈")]),_:1})]),_:1}),_(d,{class:"card-content"},{default:o(()=>[_(i,{class:"card-text"},{default:o(()=>[w("查看文档处理统计和趋势分析")]),_:1}),_(d,{class:"web-button btn-outline",style:{"margin-top":"20rpx","margin-left":"140rpx"}},{default:o(()=>[_(i,null,{default:o(()=>[w("查看统计")]),_:1})]),_:1})]),_:1})]),_:1},8,["onClick"])]),_:1}),_(d,{class:"web-card fade-in-up",style:{"margin-bottom":"60rpx"}},{default:o(()=>[_(d,{class:"card-header"},{default:o(()=>[_(i,{class:"card-title"},{default:o(()=>[w("最近处理记录")]),_:1}),_(d,{class:"web-button btn-outline",onClick:c.navigateToHistory},{default:o(()=>[_(i,null,{default:o(()=>[w("查看全部")]),_:1})]),_:1},8,["onClick"])]),_:1}),_(d,{class:"card-content"},{default:o(()=>[_(d,{class:"web-table"},{default:o(()=>[_(d,{class:"table-header"},{default:o(()=>[_(d,{class:"table-row"},{default:o(()=>[_(i,{class:"table-cell"},{default:o(()=>[w("文档名称")]),_:1}),_(i,{class:"table-cell"},{default:o(()=>[w("处理时间")]),_:1}),_(i,{class:"table-cell"},{default:o(()=>[w("状态")]),_:1}),_(i,{class:"table-cell"},{default:o(()=>[w("准确率")]),_:1})]),_:1})]),_:1}),(y(!0),h(v,null,x(n.recentHistory,(e,s)=>(y(),a(d,{key:s,class:"table-row",onClick:s=>c.viewHistoryDetail(e)},{default:o(()=>[_(i,{class:"table-cell"},{default:o(()=>[w(S(e.fileName),1)]),_:2},1024),_(i,{class:"table-cell"},{default:o(()=>[w(S(e.processTime),1)]),_:2},1024),_(i,{class:b(["table-cell","status-"+e.status])},{default:o(()=>[w(S(c.getStatusText(e.status)),1)]),_:2},1032,["class"]),_(i,{class:"table-cell"},{default:o(()=>[w(S(e.accuracy)+"%",1)]),_:2},1024)]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1}),_(d,{class:"card-grid card-grid-1 fade-in-up"},{default:o(()=>[_(d,{class:"web-card"},{default:o(()=>[_(d,{class:"card-header"},{default:o(()=>[_(i,{class:"card-title"},{default:o(()=>[w("处理性能")]),_:1}),_(i,{class:"card-icon"},{default:o(()=>[w("⚡")]),_:1})]),_:1}),_(d,{class:"card-content"},{default:o(()=>[_(d,{class:"progress-bar"},{default:o(()=>[_(d,{class:"progress-fill",style:{width:"{{ systemStats.systemPerformance }}%"}})]),_:1}),_(i,{class:"card-text"},{default:o(()=>[w("系统处理效率: "+S(n.systemStats.systemPerformance)+"%",1)]),_:1}),_(i,{class:"card-text"},{default:o(()=>[w("平均处理时间: "+S(n.systemStats.averageProcessTime)+"秒/文档",1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})}],["__scopeId","data-v-c867010f"]]);export{k as default};
